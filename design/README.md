# ネットワーク設計

## IPv6アドレス設計とロケータ設計

SRv6のSIDはIPv6アドレスと同じ形式を取りますので、
基盤となるネットワークに割り当てるアドレスとロケータをどう棲み分けていくかは設計の余地があります。

選択肢１．物理インタフェースはリンクローカルアドレスだけにして、残り全部をSRv6のロケータにする。

選択肢２．保有しているIPv6アドレスとはまったく無関係のアドレスブロックをロケータとして利用する。

選択肢３．保有しているIPv6アドレスの一部を物理ネットワーク用に、一部をロケータ用にする。


SRv6の動作を検証するだけなら、物理インタフェースにIPv6アドレスを採番する必要はなく、リンクローカルアドレスだけで十分です。
運用することを想定するのであれば、物理インタフェースにはIPv6アドレスを割り当てた方が便利です。
リンクローカルだけだと、数ホップ先のルータの物理足を指定してpingが打てなくなってしまいます。
そう考えると選択肢１は採用すべきではありません。

SRv6ネットワークを拡張したり、別のSRv6ネットワークと相互接続するときのことも考慮に入れてアドレスを管理したほうがいいでしょう。
老朽更新する際、新規にネットワークを作って古いネットワークと相互接続して移行する、ということも起こりうる話です。
となると選択肢２は採用すべきはありません。
どうやってロケータの情報を新旧のネットワークで交換するのか、無用な配慮が必要になってしまいます。

選択肢３は、物理ネットワークに採番したアドレスとロケータに採番したアドレスをひとまとめにして集約をかけられるので、SRv6ネットワーク同士を相互接続する際にも有利です。

<br><br>

## IPv6アドレス設計

APNIC／JPNICのIPv6アドレス割り当てポリシーでは、エンドサイトに割り当てる最大サイズを/48、最小サイズを/64としています。
したがってISPからアドレスを割り当ててもらう場合には/48のサイズまでなら容易に取得できます。
それよりも大きなアドレスブロックは特別な申請が必要です。

> **Note**
> アドレスにかかる費用
> https://www.nic.ad.jp/ja/ip/member/fee-table-2012.html#fee-table


/64を一つの単位とするなら、/48のアドレスは16ビット分=約6万5千個取り出せるわけですが、意味のある塊で集約をかけられる工夫が必要です。



## ロケータ設計

アドレスはサブネットに割り当てる。それに加えてルータ自身に/64のブロックを持たせる。



- ロケータのブロック部は必ず共通にすること

ロケータの先頭40ビットがブロック部。ここをエリア内のSRv6ルータで共通にすること。

- ループバックのアドレスはロケータの中から採番すること

- MTU/MSS

SRヘッダを考慮すること。

- インタフェースのネットワークタイプ

Point-to-Pointにしておくこと。

- スタティックTEの途中経路指定

ポリシーのフォールバックに期待してはダメ。
そもそも一方通行のトンネルなので、そのポリシーで通信できるかどうかをプロトコルで確認しているわけではない。
したがって、指定した途中経路にたどり着くための経路が冗長化されている必要がある。

- オーケストレータ

ないと運用で困る。
